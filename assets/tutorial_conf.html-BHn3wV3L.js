import{_ as e,c as t,o,b as a}from"./app-BNhYdo4t.js";const i={},n=a(`<h1 id="conformer-generation-in-stormm" tabindex="-1"><a class="header-anchor" href="#conformer-generation-in-stormm"><span>Conformer Generation in STORMM</span></a></h1><p>Conformer generation requires some degree of geometry optimzation guided by a force field, <a href="https://pubs.acs.org/doi/10.1021/ci100031x" target="_blank" rel="noopener noreferrer">whether that is a simple clash check or rotamer score or a complete molecular mechanics model</a>. In STORMM, conformer generation relies on a complete model such as would be admissible to molecular dynamics simulations, although there are options to reduce the level of detail. STORMM makes a provisional exploration of the combinatorial rotamer possibilities, then uses its molecular mechanics batching to perform thousands of independent energy minimizations on the GPU.</p><p>The procedure described in this tutorial may be implemented by running <a href="https://storage.googleapis.com/stormm-psivant-com-files/run_dynamics.sh" download>this script.</a> Two environment variables are required, but may already be set as a part of the STORMM build procedure. The script will prompt the user if the variables are unset.</p><h2 id="the-files-control-block" tabindex="-1"><a class="header-anchor" href="#the-files-control-block"><span>The <code>&amp;files</code> Control Block</span></a></h2><p>The contents of the <code>&amp;files</code> namelist will be familiar to those who have worked through the <a href="./tutorial_md">dynamics tutorial</a>. Most of the keys and sub-keys have cognates in the controls for AMBER programs <strong>sander</strong> and <strong>pmemd</strong>. We use the <code>-sys</code> keyword with its various sub-keys to specify several topologies and their respective input coordinates, along with &quot;trajectory&quot; files to print the resulting conformers, whatever will be found by the rotamer search and subsequent optimizations. Here is what the namelist control block for the provided example looks when the script is run in the context of STORMM&#39;s collection of example systems:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&amp;files</span>
<span class="line">  -sys { -p /home/david-cerutti/STORMM/test/Topology/drug_example_iso.top</span>
<span class="line">         -c /home/david-cerutti/STORMM/test/Trajectory/drug_example_iso.inpcrd</span>
<span class="line">         -label drug_example_iso -x conf_drug_example_iso.sdf x_kind sdf }</span>
<span class="line">  &lt;... additional input clipped ...&gt;</span>
<span class="line">&amp;end</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="the-conformer-control-block" tabindex="-1"><a class="header-anchor" href="#the-conformer-control-block"><span>The <code>&amp;conformer</code> Control Block</span></a></h2><p>Detailed controls of how the rotamer sampling and structure selection will be carried out are available in the <code>&amp;conformer</code> namelist. While this tutorial will only cover the basics, we recommend that users run the program with the name of the control block to get a complete description of all the options:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">&gt;&gt; /stormm/build/apps/Conf/conformer.stormm.cuda &quot;&amp;conformer&quot;</span>
<span class="line"></span>
<span class="line">&lt;... documentation for the namelist is printed to the terminal ...&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The first decision to make is how many rotamer settings to sample. Most rotatable bonds in chemistry have three conceivable settings, and barring large groups at either end of the bond all three will be viable to some degree, although one may be preferred. We will set the number of ticks on the &quot;wheel&quot; for a rotatable bond to 3 (the default), although if we were to set it to something like 6, three pairs of closely spaced ticks would be found centered on 120 degree strides around the circle. The same functions that perform bond rotation also carry out <em>cis-trans</em> sampling, with two possible settings and variations around them as the obvious moves to attempt.</p><p>When sampling anything with multiple independent choices, there arises the possibility of a combinatorial explosion: a molecule with four rotatable bonds might have 3<sup>4</sup> = 81 viable states, but if we wanted to sample each rotation to a finer degree the number could easily grow to over 6,000. A drug molecule with many rotatable bonds such as an oligopeptide would risk overwhelming the available memory. To deal with this problem, STORMM begins by offering the <code>effort</code> keyword, with available settings <em>minimal</em>, <em>light</em>, <em>heavy</em>, and <em>exhaustive</em>. It&#39;s more or less the power of three that the user is comfortable with:</p><ul><li>Minimal will instruct the program to prioritize sampling one of each of the rotation settings, <em>cis-trans</em> settings (if stereoisomers are being sampled), and chiral orientations (if inversions are allowed) for every rotatable bond or invertible center, irrespective of what values the others take (they will be selected at random). If there are more configurations left with the <code>trial_limit</code> these will be populated with random settings on any rotatable bond.</li><li>A light sampling implies a priority to sample every combination of settings for any neighboring pair of rotatable bonds. If there is an atom chain CA-CB-CG=CD-CZ and the CA-CB, CB-CG, and CD-CZ bonds are rotatable, CA-CB and CB-CG are coupled because they share atom CB. CD-CZ is not coupled to either of the other two rotatable bonds, however.</li><li>A heavy* setting will sample all combinations in chains of up to three rotatable bonds</li><li>An <em>exhaustive</em> approach will attempt to leave no stone unturned, but prioritize the minimal, then light, then heavy sampling up to the <code>trial_limit</code> before applying systematic sampling to each geometric element.</li></ul><p>There are also caps on the number of independent states that the conformer generator will attempt to create, to place a hard stop on the combinatorial explosion after prioriitized sampling (turn every rotatable bond, flip each <em>cis-trans</em> bond, and/or invert each chiral center while randomizing other elements). These are the <code>trial_count</code> and <code>local_trial_count</code>, which are meant to limit the total number of conformations that the program will attempt to seed for GPU optimization and the number of conformations that the program will attempt to sample for local rearrangements around any given element, respectively.</p><p>Unseen in this tutorial input is the cutoff for mutual root mean-squared deviations in particle positions, needed to ensure that the reported conformations are unique after energy minimization. The default value of 0.15 nm may be too high for some applications, but it helps to produce a diverse set in floppy molecules where rotamer sampling is essential.</p><h2 id="the-minimize-control-block" tabindex="-1"><a class="header-anchor" href="#the-minimize-control-block"><span>The <code>&amp;minimize</code> Control Block</span></a></h2><p>Energy minimization is a critical precursor to molecular simulations as it relaxes steric clashes and other strained arrangements in the structure to bleed off excess energy before it can kick the system into an unnatural configuration. Readers should consult the <a href="./tutorial_md">dynamics tutorial</a> for more information. In the conformer generator, the <code>cdcyc</code> keyword, controlling the number of cycles over which a vnaishing softcore potential is applied to non-bonded interactions, is very important. While the program will apply a rudimentary clash check to conformers that it seeds, atoms can still be left with significant overlap, leading to high van-der Waals energies. The vanishing softcore potential can salvage a great deal of otherwise inviable conformations.</p><h2 id="the-report-control-block" tabindex="-1"><a class="header-anchor" href="#the-report-control-block"><span>The <code>&amp;report</code> Control Block</span></a></h2><p>Because we have selected <code>x_kind sdf</code> in the <code>&amp;files</code> input for each system, the &quot;trajectories&quot; of best-scoring conformers will be printed in <a href="http://help.accelrysonline.com/ulm/onelab/1.0/content/ulm_pdfs/direct/reference/ctfileformats2016.pdf" target="_blank" rel="noopener noreferrer">Biovia Structure-Data Format (SDF) files</a>, a format which can compile multiple structures and also offers custom meta data and annotations. STORMM can relay critical information directly into these outputs, which another program able to read the SDF format can then catalog. The example&#39;s relevant user input for &quot;key&quot; energy components is:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">  sdf_item { -title total_energy    -label ALL -energy TOTAL_ENERGY }</span>
<span class="line">  sdf_item { -title dihedral_energy -label ALL -energy PROPER_DIHEDRAL }</span>
<span class="line">  &lt;... other items ...&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>As with many other keywords in STORMM&#39;s enhanced namelist input, <code>sdf_item</code> is repeatable.</p><h2 id="results" tabindex="-1"><a class="header-anchor" href="#results"><span>Results</span></a></h2><p>Results from the tutorial exercise can be found in <a href="https://storage.googleapis.com/stormm-psivant-com-files/conf_tutr_result.tar.gz" download> this download link</a>, including SDF files for each system&#39;s selected conformers.</p><h2 id="overall-gpu-uptime-what-to-expect" tabindex="-1"><a class="header-anchor" href="#overall-gpu-uptime-what-to-expect"><span>Overall GPU Uptime: What to Expect</span></a></h2><p>If all calculations were run on the CPU, the energy minimization would dominate the calculation time, more than 98 percent in a typical problem. However, with GPUs accelerating the calculation by 1000x or more over what a single CPU can push forward, what was 0.98 becomes 0.002, which is a small part of the remaining 0.02. The lengthiest part of the calculation, in terms of wall time, shifts to something else (our profiling indicates that it is conformer seeding and file processing), and the overall GPU uptime of the calculation is only about 20-30%. While it may be possible to add more CPU work in an MPI- or OpenMP-parallel compilation of the host code, this introduces more program complexity and eventually makes new features harder to add. Another possibility is for the operator to interleave multiple jobs on different CPUs, running STORMM through <a href="https://docs.nvidia.com/deploy/mps/index.html" target="_blank" rel="noopener noreferrer">MPS on an NVIDIA GPU</a> for a higher overall GPU utilization. The block then moves to the disk hardware, what rate the topology files and input coordinates can be read or output trajectories written. For what it is doing, however, STORMM&#39;s conformer generation is producing a huge number of molecular mechanics model optimizations in very little time.</p>`,24),r=[n];function l(s,c){return o(),t("div",null,r)}const m=e(i,[["render",l],["__file","tutorial_conf.html.vue"]]),d=JSON.parse('{"path":"/tutorials/tutorial_conf.html","title":"Conformer Generation in STORMM","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"The &files Control Block","slug":"the-files-control-block","link":"#the-files-control-block","children":[]},{"level":2,"title":"The &conformer Control Block","slug":"the-conformer-control-block","link":"#the-conformer-control-block","children":[]},{"level":2,"title":"The &minimize Control Block","slug":"the-minimize-control-block","link":"#the-minimize-control-block","children":[]},{"level":2,"title":"The &report Control Block","slug":"the-report-control-block","link":"#the-report-control-block","children":[]},{"level":2,"title":"Results","slug":"results","link":"#results","children":[]},{"level":2,"title":"Overall GPU Uptime: What to Expect","slug":"overall-gpu-uptime-what-to-expect","link":"#overall-gpu-uptime-what-to-expect","children":[]}],"git":{"updatedTime":1750150341000},"filePathRelative":"tutorials/tutorial_conf.md"}');export{m as comp,d as data};
